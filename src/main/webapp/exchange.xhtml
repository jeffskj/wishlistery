<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.prime.com.tr/ui">


    <ui:composition template="/templates/content-template.xhtml">
        <ui:param name="pageTitle" value="Gift Exchange" />
        <ui:define name="content">
            <h:form>
                <p:inplace editor="true" style="font-size:25px;font-weight:bold;">
                    <p:ajax event="save" listener="#{giftExchangeBean.save()}"/>
	                <p:inputText value="#{giftExchangeBean.entity.name}" id="name" size="40">
	                     <p:ajax event="keyup" update="nameMsg" />
	                     <p:ajax event="blur" update="nameMsg" />
	                </p:inputText>
	           </p:inplace>
               <p:message id="nameMsg" for="name"/>
           </h:form>
           <h:form>
                <h2>Participants</h2>
	            <p:autoComplete value="#{giftExchangeBean.newParticipant}" completeMethod="#{userBean.find()}"  
	                        var="u" itemLabel="#{u.firstName} #{u.lastName}" itemValue="#{u}" 
	                        size="35" style="font-size: 20px;"
	                        converter="entity" forceSelection="true">
	                <p:column>#{u.firstName}</p:column>  
	                <p:column>#{u.lastName}</p:column>
	                <p:column>#{u.email}</p:column>  
	            </p:autoComplete>  
	            
	            &nbsp;
	            
	            <p:commandButton action="#{giftExchangeBean.addNewParticipant()}" value="Add Participant" update="participantsForm"/>
	       </h:form>
           <h:form id="participantsForm">  
	            <ul style="list-style-type: none;">
	               <ui:repeat value="#{giftExchangeBean.entity.participants}" var="p">
	                   <li>
		   			         <h:outputText value="#{p.firstName} #{p.lastName}" style="width:200px;display:inline-block;"/>
						     <p:commandLink action="#{giftExchangeBean.removeParticipant(p)}" value="Remove" update="@form" />
	                   </li>
				    </ui:repeat>
				</ul>  
            </h:form>
            
             <h2>Rules</h2>
             
             <h:panelGrid columns="2">
	             People should get different people than last exchange: 
	             <p:selectBooleanCheckbox value="#{giftExchangeBean.entity.differentThanPrevious}">
	               <p:ajax listener="#{giftExchangeBean.save()}"/>
	             </p:selectBooleanCheckbox>
             </h:panelGrid>
             
             <h3>Illegal Pairings</h3>
             <h:form>
                <h:panelGrid columns="3" cellspacing="10">
                    <p:selectOneMenu value="#{giftExchangeBean.illegalPairFrom}" style="font-size:25px">
                        <f:selectItems value="#{giftExchangeBean.entity.participants}" 
                            var="p" itemValue="#{p}" itemLabel="#{p.firstName} #{p.lastName}"/>
                        <f:converter converterId="entity"/>
                    </p:selectOneMenu>
                    
                    <p:selectOneMenu value="#{giftExchangeBean.illegalPairTo}" style="font-size:25px">
                        <f:selectItems value="#{giftExchangeBean.entity.participants}" 
                            var="p" itemValue="#{p}" itemLabel="#{p.firstName} #{p.lastName}"/>
                        <f:converter converterId="entity"/>
                    </p:selectOneMenu>
                    
                    <p:commandButton action="#{giftExchangeBean.addIllegalPair()}" value="Add" update="@form"/>
                </h:panelGrid>
                  
                <ul style="list-style-type: none;">
                   <ui:repeat value="#{giftExchangeBean.entity.illegalPairs}" var="r">
                       <li>
                             <h:outputText value="#{r.from.firstName} #{r.from.lastName}" style="width:200px;display:inline-block;"/>
                             <h:outputText value="#{r.to.firstName} #{r.to.lastName}" style="width:200px;display:inline-block;"/>
                                 
                             <p:commandLink action="#{giftExchangeBean.removeIllegalPair(r)}" value="Remove" update="@form" />
                       </li>
                    </ui:repeat>
                </ul>  
            </h:form>
            
            <h2>Create Exchange Instance</h2>
            <h:form>
                <h:panelGrid columns="3">
                    <h:outputLabel value="Label:" for="label"/>
		            <p:inputText value="#{giftExchangeBean.exchangeLabel}" id="label" style="font-size: 25px;"/> 
		            <p:commandButton action="#{giftExchangeBean.createExchange()}" value="Create Exchange" update="@form"/>
                </h:panelGrid>
	            <ul style="list-style-type: none;">
                   <ui:repeat value="#{giftExchangeBean.entity.exchanges}" var="e">
                       <li>
                        <p:commandLink onclick="exchangeDetails.show()" update="exchangeDetailsForm">
                             <f:setPropertyActionListener target="#{giftExchangeBean.selectedExchange}" value="#{e}"/>
                             <h:outputText value="#{e.label}"/>
                        </p:commandLink>
                       </li>
                    </ui:repeat>
                </ul>
            </h:form>
            
            <p:dialog widgetVar="exchangeDetails" modal="true">
                <h:form id="exchangeDetailsForm">
                    Exchange Details: 
                    <h:outputText value="#{giftExchangeBean.selectedExchange.label}" />
                   
                    <p:dataTable value="#{giftExchangeBean.selectedExchangeEntries}" var="e">
                        <p:column headerText="From">#{e.from.firstName} #{e.from.lastName}</p:column>
                        <p:column headerText="To">#{e.to.firstName} #{e.to.lastName}</p:column>
                    </p:dataTable>
                </h:form>
        </p:dialog>
        </ui:define>

    </ui:composition>
</html>
