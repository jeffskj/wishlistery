<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.prime.com.tr/ui">

<ui:composition template="/templates/content-template.xhtml">

	<ui:param name="pageTitle" value="#{wishlistBean.persisted ? 'Edit' : 'Create'} Wishlist" />

	<ui:define name="content">
		<h:form id="form">
		    <h:messages globalOnly="true" />
            
           <p:inplace editor="true" saveListener="#{wishlistBean.save()}" style="font-size:25px;font-weight:bold;">
	            <p:inputText value="#{wishlistBean.entity.name}" id="name" size="40">
	                 <p:ajax event="keyup" update="nameMsg" />
	                 <p:ajax event="blur" update="nameMsg" />
	            </p:inputText>
           </p:inplace>
           <p:message id="nameMsg" for="name"/>
		</h:form>
         
         <h:outputText value="Views:" rendered="#{not empty wishlistBean.entity.views}"/> 
         <ui:repeat var="v" value="#{wishlistBean.entity.views}">
            <h:link outcome="/wishlistView.jsf" value="#{v.name}">
                <f:param name="id" value="#{v.id}" />
            </h:link>
            &nbsp;
         </ui:repeat>
         
        <h:form id="itemsForm">
	       <div style="text-align:right; padding-bottom: 15px">
	           <p:commandLink style="font-size: 12px;" value="Create View" onclick="createViewDlg.show()" />
                &nbsp;
	            <p:commandLink style="font-size: 12px;" value="Add Item" onclick="addEditItemDlg.show()" />
	            &nbsp;
	            <p:commandLink style="font-size: 12px;" value="Add Category" onclick="addCatDlg.show()" />    
	       </div>

	        <ui:repeat var="cat" value="#{wishlistBean.entity.categories}">
               <p:inplace editor="true" style="font-size:18px;font-weight:bold;" widgetVar="category#{cat.id}" rendered="#{!cat.default}">
                    
	               <p:inputText id="catName" value="#{cat.name}"/>
	               <p:ajax event="save" listener="#{wishlistBean.updateCategory()}">
	                   <f:setPropertyActionListener target="#{wishlistBean.category}" value="#{cat}"/>
	               </p:ajax>
               </p:inplace>
               <p:message id="catNameMsg" for="catName"/>
               
               <p:commandLink value="Remove Category" action="#{wishlistBean.removeCategory()}" update="itemsForm" 
                    rendered="#{empty cat.items and !cat.default}" style="position: relative; float: right">
	               <f:setPropertyActionListener target="#{wishlistBean.category}" value="#{cat}"/>
	           </p:commandLink>
               
                <ui:repeat var="it" value="#{cat.items}">
                    <span style="position:relative;float:right;top:20px;">
                        <p:commandLink value="Edit" onclick="addEditItemDlg.show()" update="addEditForm">
                             <f:setPropertyActionListener target="#{wishlistBean.item}" value="#{it}"/>
                        </p:commandLink>
                        &nbsp;
                        <p:commandLink value="Remove" action="#{wishlistBean.removeItem()}" update="itemsForm">
                            <f:setPropertyActionListener target="#{wishlistBean.item}" value="#{it}"/>
                        </p:commandLink>
                    </span>
                         
                    <ul style="list-style: none;padding-bottom:15px;">
                        <li>
                            <span style="font-weight:bold;">#{it.title}</span>
                        </li>
                        <li>
                            <h:outputText value="#{it.description}" style="font-size:14px;" rendered="#{it.link != null}"/>
                        </li>
                        <li>
                         <h:outputLink value="#{it.link}" rendered="#{it.link != null}" style="color:#2C4359">
                            #{it.trimmedLink}
                         </h:outputLink>
                        </li>
                    </ul>
               </ui:repeat>       
	        </ui:repeat>
	        
	        <ui:fragment rendered="#{wishlistBean.entity.blank}">
	           <div style="width:300px;margin: auto;">
		           <b>You have no items on your list...</b>
		           <br />
		           <br />
		           <p:commandButton value="Add Item" styleClass="cta-button" onclick="addEditItemDlg.show()"/>
	               <br />
	               <br />
	               <p:commandButton value="Add Category" styleClass="cta-button" onclick="addCatDlg.show()"/>
	           </div>
	        </ui:fragment>
	        
        </h:form>

        <p:dialog widgetVar="createViewDlg" modal="true">
	        <h:outputText value="* View names are not publicly viewable" style="font-size: 12px;"/>
            <h:form id="createViewForm">
                    <h:panelGrid columns="3">
		                <h:outputLabel value="Name:" for="viewName" />
	                    <p:inputText value="#{wishlistBean.view.name}" id="viewName" size="40">
	                        <p:ajax event="keyup" update="viewNameMsg" />
	                        <p:ajax event="blur" update="viewNameMsg" />
	                    </p:inputText>
	                   <p:message id="viewNameMsg" for="viewName"/>
                    </h:panelGrid>
                   
                   <p:commandButton value="Create" action="#{wishlistBean.createView()}" ajax="false" 
                        onclick="createViewDlg.close()"/>
            </h:form>
        </p:dialog>
        
        <p:dialog widgetVar="addEditItemDlg" modal="true">
            <h:form id="addEditForm">
                <h:panelGrid columns="3">
	               <h:outputLabel value="Category:" for="category" />
                   <p:selectOneMenu value="#{wishlistBean.item.category}" id="category" converter="entity">
                        <p:ajax />
                        <f:selectItems value="#{wishlistBean.entity.categories}" var="c" itemLabel="#{c.name}" itemValue="#{c}"/>
                   </p:selectOneMenu>
                   <p:message id="categoryMsg" for="category"/> 
	               
	               <h:outputLabel value="Title:" for="title" />
	               <p:inputText value="#{wishlistBean.item.title}" id="title" size="40">
	                    <p:ajax event="keyup" update="titleMsg" />
	                    <p:ajax event="blur" update="titleMsg" />
	               </p:inputText>
	               <p:message id="titleMsg" for="title"/>
	               
	               <h:outputLabel value="Description:" for="itemDescription" />
	               <p:inputTextarea cols="40" value="#{wishlistBean.item.description}" id="itemDescription">
	                    <p:ajax event="blur" update="itemDescriptionMsg" />
	               </p:inputTextarea>
	               <p:message id="itemDescriptionMsg" for="itemDescription"/>
                   
                   <h:outputLabel value="Link:" for="link" />
                    <p:inputText value="#{wishlistBean.item.link}" id="link" size="40">
                        <p:ajax event="keyup" update="linkMsg" />
                        <p:ajax event="blur" update="linkMsg" />
                   </p:inputText>
                   <p:message id="linkMsg" for="link"/>
               </h:panelGrid>
               
               <p:commandButton value="Add Item" action="#{wishlistBean.addItem()}" update="items" 
                    rendered="#{!wishlistBean.item.persisted}" onclick="addEditItemDlg.close()"/>
                    
               <p:commandButton value="Save" actionListener="#{wishlistBean.updateItem()}" update="items" 
                    rendered="#{wishlistBean.item.persisted}" onclick="addEditItemDlg.close()"/>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="addCatDlg" modal="true">
            <h:form>
                <h:panelGrid columns="3">
                   <h:outputLabel value="Name:" for="catName" />
                   <p:inputText value="#{wishlistBean.category.name}" id="catName" size="40">
                        <p:ajax event="keyup" update="catNameMsg" />
                        <p:ajax event="blur" update="catNameMsg" />
                   </p:inputText>
                   <p:message id="catNameMsg" for="catName"/>
               </h:panelGrid>
               <p:commandButton value="Add Category" action="#{wishlistBean.addCategory()}" update="items" onclick="addCatDlg.close()"/>
            </h:form>
        </p:dialog>
        
                
	</ui:define>

</ui:composition>
</html>

